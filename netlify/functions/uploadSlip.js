// --- ฟังก์ชัน findTransactionId ฉบับอัปเกรดล่าสุด ---
function findTransactionId(text) {
  // 1. ทำความสะอาดข้อความโดยการลบการเว้นวรรคและขึ้นบรรทัดใหม่ทั้งหมดออกไป
  // เพื่อทำให้ตัวอักษรที่อาจจะถูกอ่านแยกกัน กลับมาติดกันเหมือนเดิม
  const cleanedText = text.replace(/[\s\n]/g, '');

  // 2. ใช้ Regex ค้นหารูปแบบของรหัสอ้างอิงที่อาจจะยาวมากๆ (ตัวอักษรใหญ่และตัวเลขติดกัน 20 ตัวขึ้นไป)
  // เพิ่มความยาวขั้นต่ำเป็น 20 เพื่อความแม่นยำและหลีกเลี่ยงการเจอเบอร์โทรหรือตัวเลขอื่นๆ
  const regex = /[A-Z0-9]{20,}/g;
  const matches = cleanedText.match(regex);

  // 3. คืนค่ารหัสอ้างอิงแรกที่เจอ
  return matches && matches.length > 0 ? matches[0] : null;
}
